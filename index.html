<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduSchedule Pro - Horario Inteligente</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600;700&family=Fira+Code:wght@300;400;500&display=swap');

        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --bg-main: #0a0a0f;
            --bg-glass: rgba(255, 255, 255, 0.05);
            --bg-card: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #b8c5d6;
            --border-glass: rgba(255, 255, 255, 0.1);
            --shadow-glow: 0 8px 32px rgba(102, 126, 234, 0.3);
            --shadow-card: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        .theme-university {
            --primary: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            --secondary: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            --accent: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            --bg-main: #ecf0f1;
            --bg-glass: rgba(52, 73, 94, 0.1);
            --bg-card: rgba(255, 255, 255, 0.9);
            --text-primary: #2c3e50;
            --text-secondary: #34495e;
            --border-glass: rgba(52, 73, 94, 0.2);
            --shadow-glow: 0 8px 32px rgba(52, 152, 219, 0.2);
        }

        .theme-cyberpunk {
            --primary: linear-gradient(135deg, #ff006e 0%, #8338ec 100%);
            --secondary: linear-gradient(135deg, #00f5ff 0%, #ff006e 100%);
            --accent: linear-gradient(135deg, #39ff14 0%, #00f5ff 100%);
            --bg-main: #0d001a;
            --bg-glass: rgba(255, 0, 110, 0.1);
            --bg-card: rgba(131, 56, 236, 0.1);
            --text-primary: #00f5ff;
            --text-secondary: #ff006e;
            --border-glass: rgba(255, 0, 110, 0.3);
            --shadow-glow: 0 8px 32px rgba(255, 0, 110, 0.5);
        }

        .theme-retro {
            --primary: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            --secondary: linear-gradient(135deg, #ffd23f 0%, #ff6b35 100%);
            --accent: linear-gradient(135deg, #06ffa5 0%, #ffd23f 100%);
            --bg-main: #2d1b69;
            --bg-glass: rgba(255, 107, 53, 0.1);
            --bg-card: rgba(247, 147, 30, 0.1);
            --text-primary: #ffd23f;
            --text-secondary: #ff6b35;
            --border-glass: rgba(255, 107, 53, 0.3);
            --shadow-glow: 0 8px 32px rgba(255, 107, 53, 0.4);
            font-family: 'Fira Code', monospace !important;
        }

        .theme-neon-glitch {
            --primary: linear-gradient(135deg, #ff00ff 0%, #00ffff 100%);
            --secondary: linear-gradient(135deg, #ffff00 0%, #ff00ff 100%);
            --accent: linear-gradient(135deg, #00ff00 0%, #ffff00 100%);
            --bg-main: #000000;
            --bg-glass: rgba(255, 0, 255, 0.1);
            --bg-card: rgba(0, 255, 255, 0.1);
            --text-primary: #00ffff;
            --text-secondary: #ff00ff;
            --border-glass: rgba(255, 255, 0, 0.3);
            --shadow-glow: 0 8px 32px rgba(255, 0, 255, 0.7);
            animation: glitch-bg 5s infinite linear;
        }

        .theme-galaxy {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --bg-main: #0a0a2f;
            --bg-glass: rgba(255, 255, 255, 0.05);
            --bg-card: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #b8c5d6;
            --border-glass: rgba(255, 255, 255, 0.1);
            --shadow-glow: 0 8px 32px rgba(102, 126, 234, 0.5);
            background-image: radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 4px),
                            radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 3px),
                            radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 4px);
            background-size: 550px 550px, 350px 350px, 250px 250px;
            background-position: 0 0, 40px 60px, 130px 270px;
            animation: stars 20s linear infinite;
        }

        .theme-synthwave {
            --primary: linear-gradient(135deg, #ff00ff 0%, #ff0080 100%);
            --secondary: linear-gradient(135deg, #00ffff 0%, #0080ff 100%);
            --accent: linear-gradient(135deg, #ffff00 0%, #ff8000 100%);
            --bg-main: #1a0033;
            --bg-glass: rgba(255, 0, 255, 0.1);
            --bg-card: rgba(0, 255, 255, 0.1);
            --text-primary: #00ffff;
            --text-secondary: #ff00ff;
            --border-glass: rgba(255, 255, 0, 0.3);
            --shadow-glow: 0 8px 32px rgba(255, 0, 255, 0.5);
            background: linear-gradient(45deg, #1a0033, #33001a, #00331a);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
        }

        .theme-rainbow {
            --primary: linear-gradient(135deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #0000ff, #8000ff);
            --secondary: linear-gradient(135deg, #ff0080, #ff00ff, #8000ff, #0080ff, #00ffff, #00ff80, #80ff00);
            --accent: linear-gradient(135deg, #ffff00, #ff8000, #ff0000, #ff0080, #ff00ff, #8000ff, #0080ff);
            --bg-main: #000000;
            --bg-glass: rgba(255, 255, 255, 0.1);
            --bg-card: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-glass: rgba(255, 255, 255, 0.2);
            --shadow-glow: 0 8px 32px rgba(255, 0, 0, 0.3);
            animation: rainbow 10s infinite linear;
        }

        .reading-mode {
            font-size: 1.2em;
            --text-primary: #000000;
            --bg-main: #f8f9fa;
            --bg-card: #ffffff;
            --bg-glass: rgba(0, 0, 0, 0.05);
        }

        @keyframes glitch-bg {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(180deg); }
        }

        @keyframes stars {
            from { background-position: 0 0, 40px 60px, 130px 270px; }
            to { background-position: 550px 550px, 390px 410px, 380px 520px; }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes rainbow {
            0% { --primary: linear-gradient(135deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #0000ff, #8000ff); }
            14% { --primary: linear-gradient(135deg, #8000ff, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #0000ff); }
            28% { --primary: linear-gradient(135deg, #0000ff, #8000ff, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff); }
            42% { --primary: linear-gradient(135deg, #0080ff, #0000ff, #8000ff, #ff0000, #ff8000, #ffff00, #00ff00); }
            57% { --primary: linear-gradient(135deg, #00ff00, #0080ff, #0000ff, #8000ff, #ff0000, #ff8000, #ffff00); }
            71% { --primary: linear-gradient(135deg, #ffff00, #00ff00, #0080ff, #0000ff, #8000ff, #ff0000, #ff8000); }
            85% { --primary: linear-gradient(135deg, #ff8000, #ffff00, #00ff00, #0080ff, #0000ff, #8000ff, #ff0000); }
            100% { --primary: linear-gradient(135deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #0000ff, #8000ff); }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: all 0.3s ease;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--text-secondary);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            from { transform: translateY(100vh) rotate(0deg); }
            to { transform: translateY(-100vh) rotate(360deg); }
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-glass);
            z-index: 1000;
            padding: 1rem 2rem;
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            background: var(--primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        .navbar-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .main-container {
            margin-top: 100px;
            padding: 2rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .clock-container {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid var(--border-glass);
            box-shadow: var(--shadow-card);
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .clock-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
            opacity: 0.7;
        }

        .clock-time {
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: var(--primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        .clock-date {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .class-status {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            display: inline-block;
        }

        .class-status.in-class {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(56, 142, 60, 0.2));
            color: #4CAF50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .class-status.break-time {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 152, 0, 0.2));
            color: #FFC107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .class-status.free-time {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.2), rgba(30, 136, 229, 0.2));
            color: #2196F3;
            border: 1px solid rgba(33, 150, 243, 0.3);
        }

        .class-status.outside-hours {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(229, 57, 53, 0.2));
            color: #F44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .countdown {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .funny-message {
            font-style: italic;
            margin-top: 0.5rem;
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .tool-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            border: 1px solid var(--border-glass);
            padding: 1.5rem;
        }

        .tool-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .weekend-countdown {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 1rem 0;
            background: var(--secondary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .search-box {
            width: 100%;
            padding: 0.8rem;
            border-radius: 10px;
            border: 1px solid var(--border-glass);
            background: var(--bg-glass);
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .search-results {
            max-height: 200px;
            overflow-y: auto;
        }

        .search-result {
            padding: 0.5rem;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            background: var(--bg-glass);
            cursor: pointer;
            transition: background 0.3s;
        }

        .search-result:hover {
            background: var(--border-glass);
        }

        .control-panel {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid var(--border-glass);
            box-shadow: var(--shadow-card);
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .control-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
            opacity: 0.7;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            align-items: center;
        }

        .btn {
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 12px;
            padding: 0.8rem 1.5rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-glow);
        }

        .schedule-container {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid var(--border-glass);
            box-shadow: var(--shadow-card);
            overflow: hidden;
            position: relative;
        }

        .schedule-header {
            background: var(--primary);
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }

        .schedule-title {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .table-container {
            overflow-x: auto;
            position: relative;
        }

        #scheduleTable {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        #scheduleTable th {
            background: var(--bg-glass);
            color: var(--text-primary);
            padding: 1rem;
            font-weight: 600;
            text-align: center;
            border-bottom: 1px solid var(--border-glass);
            position: sticky;
            top: 0;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        #scheduleTable td {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border-glass);
            border-right: 1px solid var(--border-glass);
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        #scheduleTable td:hover {
            background: var(--bg-glass);
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .time-cell {
            background: var(--secondary);
            color: white !important;
            font-weight: 600;
            font-family: 'Orbitron', monospace;
        }

        .break-row td {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 87, 34, 0.2));
            font-style: italic;
        }

        .current-class {
            position: relative;
            z-index: 5;
            animation: pulse-glow 2s infinite;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5) !important;
            border: 2px solid #4CAF50 !important;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.5); }
            50% { box-shadow: 0 0 30px rgba(76, 175, 80, 0.8); }
        }

        .subject-som { background: linear-gradient(135deg, rgba(74, 144, 226, 0.2), rgba(80, 170, 241, 0.2)); }
        .subject-red { background: linear-gradient(135deg, rgba(225, 112, 85, 0.2), rgba(237, 117, 88, 0.2)); }
        .subject-dig { background: linear-gradient(135deg, rgba(129, 236, 236, 0.2), rgba(116, 185, 255, 0.2)); }
        .subject-ofi { background: linear-gradient(135deg, rgba(123, 239, 178, 0.2), rgba(77, 182, 172, 0.2)); }
        .subject-ipe { background: linear-gradient(135deg, rgba(255, 154, 158, 0.2), rgba(250, 208, 196, 0.2)); }
        .subject-mon { background: linear-gradient(135deg, rgba(186, 85, 211, 0.2), rgba(224, 130, 131, 0.2)); }
        .subject-sos { background: linear-gradient(135deg, rgba(255, 218, 121, 0.2), rgba(254, 202, 87, 0.2)); }

        .achievement-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-glass);
            border-radius: 20px;
            margin: 0.25rem;
            font-size: 0.9rem;
        }

        .badge-locked {
            opacity: 0.5;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--bg-glass);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border-glass);
            box-shadow: var(--shadow-card);
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
            backdrop-filter: blur(10px);
        }

        /* Minijuegos */
        .minigame-container {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-glass);
            border-radius: 10px;
        }

        .game-question {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .game-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .game-result {
            margin-top: 1rem;
            font-weight: 600;
            min-height: 1.5rem;
        }

        .quiz-timer {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
            color: var(--accent);
        }

        .puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .puzzle-piece {
            padding: 1rem;
            background: var(--bg-glass);
            border-radius: 5px;
            cursor: move;
            text-align: center;
            border: 2px solid transparent;
        }

        .puzzle-piece.correct {
            border-color: #4CAF50;
        }

        .race-track {
            height: 100px;
            background: var(--bg-glass);
            border-radius: 10px;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .race-player {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            transition: left 0.5s ease;
        }

        .target-game {
            height: 200px;
            background: var(--bg-glass);
            border-radius: 10px;
            margin: 1rem 0;
            position: relative;
            cursor: crosshair;
            overflow: hidden;
        }

        .target {
            position: absolute;
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .main-container {
                padding: 1rem;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>

    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">EduSchedule Pro</div>
            <div class="navbar-controls">
                <select id="themeSelector" class="btn">
                    <option value="">🎨 Futurista</option>
                    <option value="university">🏛️ Universidad</option>
                    <option value="cyberpunk">🌆 Cyberpunk</option>
                    <option value="retro">👾 Retro</option>
                    <option value="neon-glitch">⚡ Neón Glitch</option>
                    <option value="galaxy">🌌 Galaxia</option>
                    <option value="synthwave">🎵 Synthwave</option>
                    <option value="rainbow">🌈 Arcoíris</option>
                </select>
                <button class="btn" onclick="toggleReadingMode()">👓 Modo Lectura</button>
                <button class="btn" onclick="toggleFullscreen()">⛶ Pantalla Completa</button>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- Dashboard Principal -->
        <div class="dashboard-grid">
            <!-- Sección Principal -->
            <div>
                <!-- Reloj y Estado -->
                <div class="clock-container">
                    <div class="clock-time" id="clockTime">--:--:--</div>
                    <div class="clock-date" id="clockDate">Cargando...</div>
                    <div class="class-status" id="classStatus">Verificando horario...</div>
                    <div class="countdown" id="countdown"></div>
                    <div class="funny-message" id="funnyMessage"></div>
                </div>

                <!-- Panel de Control -->
                <div class="control-panel">
                    <div class="controls-grid">
                        <button class="btn" onclick="toggleAbbreviations()">
                            <span>📝</span> Abreviaturas
                        </button>
                        <button class="btn" onclick="toggleColors()">
                            <span>🎨</span> Colores
                        </button>
                        <button class="btn" onclick="showAchievements()">
                            <span>🏆</span> Logros
                        </button>
                        <button class="btn" onclick="showGradeCalculator()">
                            <span>📊</span> Calculadora
                        </button>
                        <button class="btn" onclick="exportAsPNG()">
                            <span>🖼️</span> Exportar PNG
                        </button>
                        <button class="btn" onclick="generateWallpaper()">
                            <span>🎨</span> Crear Wallpaper
                        </button>
                        <button class="btn" onclick="showMinigames()">
                            <span>🎮</span> Minijuegos
                        </button>
                    </div>
                </div>

                <!-- Horario -->
                <div class="schedule-container" id="scheduleForExport">
                    <div class="schedule-header">
                        <h1 class="schedule-title">Horario Académico</h1>
                    </div>
                    <div class="table-container">
                        <table id="scheduleTable"></table>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Búsqueda -->
                <div class="tool-card">
                    <div class="tool-title">🔍 Buscar en Horario</div>
                    <input type="text" class="search-box" placeholder="Buscar materia..." oninput="searchSchedule(this.value)">
                    <div class="search-results" id="searchResults"></div>
                </div>

                <!-- Fin de Semana -->
                <div class="tool-card">
                    <div class="tool-title">📅 Fin de Semana</div>
                    <div class="weekend-countdown" id="weekendCountdown">--</div>
                    <div class="funny-message" id="weekendMessage">¡Tú puedes!</div>
                </div>

                <!-- Estadísticas Rápidas -->
                <div class="tool-card">
                    <div class="tool-title">📈 Estadísticas</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalHours">0</div>
                            <div>Horas/Semana</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalSubjects">0</div>
                            <div>Materias</div>
                        </div>
                    </div>
                </div>

                <!-- Minijuegos Rápidos -->
                <div class="tool-card">
                    <div class="tool-title">🎮 Minijuegos</div>
                    <div class="minigame-container">
                        <button class="btn" onclick="startQuizRush()" style="width: 100%; margin-bottom: 0.5rem;">
                            🎯 Quiz Rush
                        </button>
                        <button class="btn" onclick="startSchedulePuzzle()" style="width: 100%; margin-bottom: 0.5rem;">
                            🧩 Ordena Horario
                        </button>
                        <button class="btn" onclick="startSubjectRace()" style="width: 100%; margin-bottom: 0.5rem;">
                            🏆 Carrera Materias
                        </button>
                        <button class="btn" onclick="startTargetPractice()" style="width: 100%;">
                            🎯 Target Practice
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Logros -->
    <div class="modal" id="achievementsModal">
        <div class="modal-content">
            <h2>🏆 Logros Desbloqueados</h2>
            <div id="achievementsList"></div>
            <button class="btn" onclick="closeModal('achievementsModal')" style="margin-top: 1rem; width: 100%;">Cerrar</button>
        </div>
    </div>

    <!-- Modal Calculadora -->
    <div class="modal" id="calculatorModal">
        <div class="modal-content">
            <h2>📊 Calculadora de Promedio</h2>
            <div id="calculatorContent">
                <input type="number" class="search-box" placeholder="Nota actual" id="currentGrade">
                <input type="number" class="search-box" placeholder="Ponderación (%)" id="weight">
                <input type="number" class="search-box" placeholder="Nota deseada" id="desiredGrade">
                <button class="btn" onclick="calculateRequiredGrade()" style="width: 100%; margin-top: 1rem;">Calcular</button>
                <div id="calculationResult" style="margin-top: 1rem; text-align: center;"></div>
            </div>
            <button class="btn" onclick="closeModal('calculatorModal')" style="margin-top: 1rem; width: 100%;">Cerrar</button>
        </div>
    </div>

    <!-- Modal Minijuegos -->
    <div class="modal" id="minigamesModal">
        <div class="modal-content">
            <h2>🎮 Minijuegos</h2>
            <div id="minigamesContent">
                <!-- Contenido dinámico de minijuegos -->
            </div>
            <button class="btn" onclick="closeModal('minigamesModal')" style="margin-top: 1rem; width: 100%;">Cerrar</button>
        </div>
    </div>

    <script>
        // Datos del horario
        const scheduleData = [
            ['8:30 - 9:30', 'Sistemas Operativos Monopuesto', 'Redes Locales', 'Digitalización Aplicada a los Sectores Productivos GM', 'Aplicaciones Ofimáticas', 'Aplicaciones Ofimáticas'],
            ['9:30 - 10:30', 'Sistemas Operativos Monopuesto', 'Redes Locales', 'Sistemas Operativos Monopuesto', 'Aplicaciones Ofimáticas', 'Aplicaciones Ofimáticas'],
            ['10:30 - 11:30', 'Aplicaciones Ofimáticas', 'Redes Locales', 'Sistemas Operativos Monopuesto', 'Itinerario Personal para la Empleabilidad I', 'Sistemas Operativos Monopuesto'],
            ['11:30 - 12:00', 'DESCANSO', 'DESCANSO', 'DESCANSO', 'DESCANSO', 'DESCANSO'],
            ['12:00 - 13:00', 'Aplicaciones Ofimáticas', 'Montaje y Mantenimiento de Equipo', 'Redes Locales', 'Redes Locales', 'Montaje y Mantenimiento de Equipo'],
            ['13:00 - 14:00', 'Montaje y Mantenimiento de Equipo', 'Montaje y Mantenimiento de Equipo', 'Redes Locales', 'Redes Locales', 'Itinerario Personal para la Empleabilidad I'],
            ['14:00 - 14:55', 'Montaje y Mantenimiento de Equipo', 'Itinerario Personal para la Empleabilidad I', 'Aplicaciones Ofimáticas', 'Montaje y Mantenimiento de Equipo', 'Sostenibilidad Aplicada al Sistema Productivo']
        ];

        const subjectAbbreviations = {
            'Sistemas Operativos Monopuesto': 'SIOPM',
            'Redes Locales': 'REDLO',
            'Digitalización Aplicada a los Sectores Productivos GM': 'DASPGM',
            'Aplicaciones Ofimáticas': 'APLOF',
            'Itinerario Personal para la Empleabilidad I': 'IPE I',
            'Montaje y Mantenimiento de Equipo': 'MOMAE',
            'Sostenibilidad Aplicada al Sistema Productivo': 'SASP'
        };

        const subjectColors = {
            'Sistemas Operativos Monopuesto': 'subject-som',
            'Redes Locales': 'subject-red',
            'Digitalización Aplicada a los Sectores Productivos GM': 'subject-dig',
            'Aplicaciones Ofimáticas': 'subject-ofi',
            'Itinerario Personal para la Empleabilidad I': 'subject-ipe',
            'Montaje y Mantenimiento de Equipo': 'subject-mon',
            'Sostenibilidad Aplicada al Sistema Productivo': 'subject-sos'
        };

        const subjectIcons = {
            'Sistemas Operativos Monopuesto': '💻',
            'Redes Locales': '🌐',
            'Digitalización Aplicada a los Sectores Productivos GM': '📱',
            'Aplicaciones Ofimáticas': '📄',
            'Itinerario Personal para la Empleabilidad I': '🎯',
            'Montaje y Mantenimiento de Equipo': '🔧',
            'Sostenibilidad Aplicada al Sistema Productivo': '🌱'
        };

        const achievements = [
            { id: 'first_use', name: 'Primer Día', description: 'Usaste la app por primera vez', icon: '🎯', unlocked: false },
            { id: 'week_complete', name: 'Semana Completa', description: 'Revisaste el horario toda la semana', icon: '📅', unlocked: false },
            { id: 'night_owl', name: 'Búho Nocturno', description: 'Usaste la app después de las 10 PM', icon: '🦉', unlocked: false },
            { id: 'early_bird', name: 'Madrugador', description: 'Usaste la app antes de las 7 AM', icon: '🐦', unlocked: false },
            { id: 'theme_master', name: 'Maestro de Temas', description: 'Probaste todos los temas', icon: '🎨', unlocked: false }
        ];

        // Preguntas para minijuegos
        const quizQuestions = [
            {
                question: "¿Qué protocolo se utiliza principalmente para la transmisión de correos electrónicos?",
                options: ["HTTP", "FTP", "SMTP", "TCP"],
                answer: 2
            },
            {
                question: "¿Qué significa la sigla RAM?",
                options: ["Random Access Memory", "Read Access Memory", "Rapid Access Memory", "Random Allocation Memory"],
                answer: 0
            },
            {
                question: "¿Qué lenguaje de programación se considera el 'padre' de muchos lenguajes modernos?",
                options: ["Python", "C", "Java", "Assembly"],
                answer: 1
            }
        ];

        // Estado de la aplicación
        let state = {
            showAbbreviations: false,
            showColors: true,
            readingMode: false,
            presentationMode: false,
            currentTheme: '',
            currentClassCell: null,
            unlockedAchievements: new Set()
        };

        // Variables para minijuegos
        let quizTimer;
        let quizTimeLeft = 30;
        let quizScore = 0;
        let currentQuizQuestion = 0;
        let racePosition = 0;
        let targetScore = 0;
        let targetGameInterval;

        // Función para crear partículas
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            renderSchedule();
            setupEventListeners();
            calculateStats();
            updateClock();
            setInterval(updateClock, 1000);
            updateWeekendCountdown();
            loadAchievements();
            
            unlockAchievement('first_use');
        });

        // ========== FUNCIONES PRINCIPALES ==========

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES');
            const dateString = now.toLocaleDateString('es-ES', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            document.getElementById('clockTime').textContent = timeString;
            document.getElementById('clockDate').textContent = dateString.charAt(0).toUpperCase() + dateString.slice(1);
            
            const currentStatus = getCurrentClassStatus(now);
            updateClassStatus(currentStatus);
            updateTableMarker(now);

            checkTimeBasedAchievements(now);
        }

        function getCurrentClassStatus(now) {
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const currentDay = now.getDay() - 1;
            
            if (currentDay < 0 || currentDay > 4) {
                return {
                    status: 'outside-hours',
                    message: '¡Es fin de semana! 🎉',
                    countdown: null,
                    funnyMessage: getRandomFunnyMessage()
                };
            }
            
            for (let i = 0; i < scheduleData.length; i++) {
                const timeRange = scheduleData[i][0];
                const [startTime, endTime] = parseTimeRange(timeRange);
                
                if (currentTime >= startTime && currentTime <= endTime) {
                    const subject = scheduleData[i][currentDay + 1];
                    
                    if (subject === 'DESCANSO') {
                        return {
                            status: 'break-time',
                            message: '¡Hora de descanso! ☕',
                            countdown: null,
                            funnyMessage: 'Aprovecha para recargar energías'
                        };
                    } else {
                        return {
                            status: 'in-class',
                            message: `En clase: ${subject}`,
                            countdown: null,
                            funnyMessage: null
                        };
                    }
                }
            }
            
            let nextClassTime = null;
            let nextClassSubject = null;
            
            for (let i = 0; i < scheduleData.length; i++) {
                const timeRange = scheduleData[i][0];
                const [startTime, endTime] = parseTimeRange(timeRange);
                
                if (currentTime < startTime) {
                    nextClassTime = startTime;
                    nextClassSubject = scheduleData[i][currentDay + 1];
                    break;
                }
            }
            
            if (!nextClassTime) {
                return {
                    status: 'outside-hours',
                    message: '¡No hay más clases hoy! 🎉',
                    countdown: null,
                    funnyMessage: getRandomFunnyMessage()
                };
            }
            
            const timeRemaining = nextClassTime - currentTime;
            const hours = Math.floor(timeRemaining / 60);
            const minutes = timeRemaining % 60;
            
            let countdownText = '';
            if (hours > 0) {
                countdownText = `Faltan ${hours}h ${minutes}m`;
            } else {
                countdownText = `Faltan ${minutes} minutos`;
            }
            
            return {
                status: 'free-time',
                message: `Próxima clase: ${nextClassSubject}`,
                countdown: countdownText,
                funnyMessage: getRandomFunnyMessage()
            };
        }

        function updateClassStatus(status) {
            const classStatusElement = document.getElementById('classStatus');
            const countdownElement = document.getElementById('countdown');
            const funnyMessageElement = document.getElementById('funnyMessage');
            
            classStatusElement.textContent = status.message;
            classStatusElement.className = 'class-status ' + status.status;
            countdownElement.textContent = status.countdown || '';
            funnyMessageElement.textContent = status.funnyMessage || '';
        }

        function updateTableMarker(now) {
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const currentDay = now.getDay() - 1;
            
            if (state.currentClassCell) {
                state.currentClassCell.classList.remove('current-class');
                state.currentClassCell = null;
            }
            
            if (currentDay < 0 || currentDay > 4) return;
            
            for (let i = 0; i < scheduleData.length; i++) {
                const timeRange = scheduleData[i][0];
                const [startTime, endTime] = parseTimeRange(timeRange);
                
                if (currentTime >= startTime && currentTime <= endTime) {
                    const table = document.getElementById('scheduleTable');
                    if (table.rows.length > i + 1) {
                        const cell = table.rows[i + 1].cells[currentDay + 1];
                        if (cell) {
                            cell.classList.add('current-class');
                            state.currentClassCell = cell;
                        }
                    }
                    break;
                }
            }
        }

        function parseTimeRange(timeRange) {
            const [startStr, endStr] = timeRange.split(' - ');
            const [startHour, startMinute] = startStr.split(':').map(Number);
            const [endHour, endMinute] = endStr.split(':').map(Number);
            
            return [
                startHour * 60 + startMinute,
                endHour * 60 + endMinute
            ];
        }

        function getRandomFunnyMessage() {
            const messages = [
                "¡El café está listo para la próxima clase! ☕",
                "¿Quizás es momento de un pequeño descanso? 😴",
                "¡Aprovecha para repasar! O no... 😉",
                "Tiempo para estirar las piernas 🦵",
                "¿Alguien dijo merienda? 🍪"
            ];
            return messages[Math.floor(Math.random() * messages.length)];
        }

        // ========== FUNCIONES DE CONTROL ==========

        function toggleAbbreviations() {
            state.showAbbreviations = !state.showAbbreviations;
            renderSchedule();
            showNotification(state.showAbbreviations ? '📝 Abreviaturas activadas' : '📝 Abreviaturas desactivadas');
        }

        function toggleColors() {
            state.showColors = !state.showColors;
            renderSchedule();
            showNotification(state.showColors ? '🎨 Colores activados' : '🎨 Colores desactivados');
        }

        function toggleReadingMode() {
            state.readingMode = !state.readingMode;
            document.body.classList.toggle('reading-mode', state.readingMode);
            showNotification(state.readingMode ? '👓 Modo lectura activado' : '👓 Modo lectura desactivado');
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                showNotification('⛶ Modo pantalla completa activado');
            } else {
                document.exitFullscreen();
                showNotification('⛶ Modo pantalla completa desactivado');
            }
        }

        // ========== EXPORTACIÓN PNG ==========

        function exportAsPNG() {
            showNotification('📸 Capturando horario...', 'info');
            
            const element = document.getElementById('scheduleForExport');
            
            html2canvas(element, {
                backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg-main'),
                scale: 2,
                useCORS: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'mi-horario.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                showNotification('✅ Horario exportado como PNG', 'success');
            }).catch(error => {
                console.error('Error al exportar:', error);
                showNotification('❌ Error al exportar', 'error');
            });
        }

        function generateWallpaper() {
            showNotification('🎨 Creando wallpaper personalizado...', 'info');
            
            // Simulación de generación de wallpaper
            setTimeout(() => {
                showNotification('✅ Wallpaper creado (simulación)', 'success');
            }, 2000);
        }

        // ========== MINIJUEGOS ==========

        function showMinigames() {
            const modal = document.getElementById('minigamesModal');
            const content = document.getElementById('minigamesContent');
            
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 1rem;">
                    <h3>🎮 Elige un Minijuego</h3>
                    <p>Practica mientras esperas tu próxima clase</p>
                </div>
                <div class="controls-grid">
                    <button class="btn" onclick="startQuizRush()">
                        🎯 Quiz Rush
                    </button>
                    <button class="btn" onclick="startSchedulePuzzle()">
                        🧩 Ordena Horario
                    </button>
                    <button class="btn" onclick="startSubjectRace()">
                        🏆 Carrera Materias
                    </button>
                    <button class="btn" onclick="startTargetPractice()">
                        🎯 Target Practice
                    </button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function startQuizRush() {
            closeModal('minigamesModal');
            quizScore = 0;
            currentQuizQuestion = 0;
            quizTimeLeft = 30;
            
            const modal = document.getElementById('minigamesModal');
            const content = document.getElementById('minigamesContent');
            
            content.innerHTML = `
                <div style="text-align: center;">
                    <h3>🎯 Quiz Rush</h3>
                    <div class="quiz-timer" id="quizTimer">⏱️ ${quizTimeLeft}s</div>
                    <div class="game-question" id="quizQuestion"></div>
                    <div class="game-options" id="quizOptions"></div>
                    <div class="game-result" id="quizResult"></div>
                    <div style="margin-top: 1rem;">
                        <strong>Puntuación: <span id="quizScore">0</span></strong>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            loadQuizQuestion();
            startQuizTimer();
        }

        function startQuizTimer() {
            quizTimer = setInterval(() => {
                quizTimeLeft--;
                document.getElementById('quizTimer').textContent = `⏱️ ${quizTimeLeft}s`;
                
                if (quizTimeLeft <= 0) {
                    endQuizGame();
                }
            }, 1000);
        }

        function loadQuizQuestion() {
            if (currentQuizQuestion >= quizQuestions.length) {
                currentQuizQuestion = 0; // Reiniciar preguntas
            }
            
            const question = quizQuestions[currentQuizQuestion];
            document.getElementById('quizQuestion').textContent = question.question;
            
            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'btn';
                button.textContent = option;
                button.onclick = () => checkQuizAnswer(index, question.answer);
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('quizResult').textContent = '';
        }

        function checkQuizAnswer(selectedIndex, correctIndex) {
            const resultElement = document.getElementById('quizResult');
            
            if (selectedIndex === correctIndex) {
                quizScore += 10;
                resultElement.textContent = '✅ ¡Correcto! +10 puntos';
                resultElement.style.color = '#4CAF50';
            } else {
                resultElement.textContent = '❌ Incorrecto';
                resultElement.style.color = '#F44336';
            }
            
            document.getElementById('quizScore').textContent = quizScore;
            currentQuizQuestion++;
            
            setTimeout(() => {
                if (currentQuizQuestion < quizQuestions.length) {
                    loadQuizQuestion();
                } else {
                    currentQuizQuestion = 0;
                    loadQuizQuestion();
                }
            }, 1500);
        }

        function endQuizGame() {
            clearInterval(quizTimer);
            document.getElementById('minigamesContent').innerHTML = `
                <div style="text-align: center;">
                    <h3>🎯 Quiz Rush - Fin del Juego</h3>
                    <div style="font-size: 2rem; margin: 1rem 0;">Puntuación Final: ${quizScore}</div>
                    <button class="btn" onclick="startQuizRush()" style="margin: 0.5rem;">Jugar Otra Vez</button>
                    <button class="btn" onclick="showMinigames()" style="margin: 0.5rem;">Otros Juegos</button>
                </div>
            `;
        }

        function startSchedulePuzzle() {
            closeModal('minigamesModal');
            
            const modal = document.getElementById('minigamesModal');
            const content = document.getElementById('minigamesContent');
            
            // Crear piezas desordenadas del horario
            const puzzlePieces = [
                '8:30 - SIOPM',
                '9:30 - REDLO', 
                '10:30 - APLOF',
                '12:00 - MOMAE',
                '13:00 - IPE I',
                '14:00 - SASP'
            ].sort(() => Math.random() - 0.5);
            
            content.innerHTML = `
                <div style="text-align: center;">
                    <h3>🧩 Ordena el Horario</h3>
                    <p>Arrastra las piezas para ordenarlas cronológicamente</p>
                    <div class="puzzle-container" id="puzzleContainer"></div>
                    <div class="game-result" id="puzzleResult"></div>
                    <button class="btn" onclick="checkPuzzleOrder()" style="margin-top: 1rem;">Comprobar Orden</button>
                </div>
            `;
            
            const container = document.getElementById('puzzleContainer');
            puzzlePieces.forEach((piece, index) => {
                const div = document.createElement('div');
                div.className = 'puzzle-piece';
                div.textContent = piece;
                div.draggable = true;
                div.dataset.index = index;
                div.dataset.correct = ['0','1','2','3','4','5'].indexOf(index.toString());
                container.appendChild(div);
            });
            
            modal.style.display = 'flex';
        }

        function checkPuzzleOrder() {
            const pieces = document.querySelectorAll('.puzzle-piece');
            let correct = true;
            
            pieces.forEach((piece, index) => {
                if (parseInt(piece.dataset.index) !== parseInt(piece.dataset.correct)) {
                    correct = false;
                    piece.classList.remove('correct');
                } else {
                    piece.classList.add('correct');
                }
            });
            
            const resultElement = document.getElementById('puzzleResult');
            if (correct) {
                resultElement.textContent = '✅ ¡Perfecto! Horario ordenado correctamente';
                resultElement.style.color = '#4CAF50';
            } else {
                resultElement.textContent = '❌ Sigue intentándolo';
                resultElement.style.color = '#F44336';
            }
        }

        function startSubjectRace() {
            closeModal('minigamesModal');
            racePosition = 0;
            
            const modal = document.getElementById('minigamesModal');
            const content = document.getElementById('minigamesContent');
            
            content.innerHTML = `
                <div style="text-align: center;">
                    <h3>🏆 Carrera de Materias</h3>
                    <p>Responde preguntas para avanzar en la carrera</p>
                    <div class="race-track">
                        <div class="race-player" id="racePlayer">🚀</div>
                    </div>
                    <div class="game-question" id="raceQuestion">¿Preparado para la carrera?</div>
                    <div class="game-options" id="raceOptions"></div>
                    <div class="game-result" id="raceResult"></div>
                    <button class="btn" onclick="askRaceQuestion()" style="margin-top: 1rem;">Comenzar Carrera</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function askRaceQuestion() {
            const randomQuestion = quizQuestions[Math.floor(Math.random() * quizQuestions.length)];
            document.getElementById('raceQuestion').textContent = randomQuestion.question;
            
            const optionsContainer = document.getElementById('raceOptions');
            optionsContainer.innerHTML = '';
            
            randomQuestion.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'btn';
                button.textContent = option;
                button.onclick = () => checkRaceAnswer(index, randomQuestion.answer);
                optionsContainer.appendChild(button);
            });
        }

        function checkRaceAnswer(selectedIndex, correctIndex) {
            const resultElement = document.getElementById('raceResult');
            const player = document.getElementById('racePlayer');
            
            if (selectedIndex === correctIndex) {
                racePosition += 20;
                player.style.left = racePosition + 'px';
                resultElement.textContent = '✅ ¡Correcto! Avanzas 20px';
                resultElement.style.color = '#4CAF50';
                
                if (racePosition >= 250) {
                    resultElement.textContent = '🎉 ¡Ganaste la carrera!';
                    setTimeout(() => showMinigames(), 2000);
                } else {
                    setTimeout(askRaceQuestion, 1500);
                }
            } else {
                resultElement.textContent = '❌ Incorrecto, pierdes turno';
                resultElement.style.color = '#F44336';
                setTimeout(askRaceQuestion, 1500);
            }
        }

        function startTargetPractice() {
            closeModal('minigamesModal');
            targetScore = 0;
            
            const modal = document.getElementById('minigamesModal');
            const content = document.getElementById('minigamesContent');
            
            content.innerHTML = `
                <div style="text-align: center;">
                    <h3>🎯 Target Practice</h3>
                    <p>Haz clic en las respuestas correctas antes de que desaparezcan</p>
                    <div style="margin: 1rem 0;">
                        <strong>Puntuación: <span id="targetScore">0</span></strong>
                    </div>
                    <div class="target-game" id="targetGame"></div>
                    <div class="game-result" id="targetResult"></div>
                    <button class="btn" onclick="startTargetGame()" style="margin-top: 1rem;">Comenzar Juego</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function startTargetGame() {
            const gameContainer = document.getElementById('targetGame');
            const scoreElement = document.getElementById('targetScore');
            const resultElement = document.getElementById('targetResult');
            
            gameContainer.innerHTML = '';
            targetScore = 0;
            scoreElement.textContent = '0';
            resultElement.textContent = '';
            
            // Crear targets
            targetGameInterval = setInterval(() => {
                if (document.querySelectorAll('.target').length < 5) {
                    createTarget();
                }
            }, 1000);
            
            // Terminar juego después de 30 segundos
            setTimeout(() => {
                endTargetGame();
            }, 30000);
        }

        function createTarget() {
            const gameContainer = document.getElementById('targetGame');
            const target = document.createElement('div');
            target.className = 'target';
            
            const isCorrect = Math.random() > 0.5;
            const subjects = Object.keys(subjectAbbreviations);
            const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
            
            target.textContent = isCorrect ? subjectAbbreviations[randomSubject] : 'XXXX';
            target.dataset.correct = isCorrect;
            
            const x = Math.random() * (gameContainer.offsetWidth - 40);
            const y = Math.random() * (gameContainer.offsetHeight - 40);
            
            target.style.left = x + 'px';
            target.style.top = y + 'px';
            
            target.onclick = function() {
                if (this.dataset.correct === 'true') {
                    targetScore += 10;
                    document.getElementById('targetScore').textContent = targetScore;
                    this.remove();
                } else {
                    targetScore = Math.max(0, targetScore - 5);
                    document.getElementById('targetScore').textContent = targetScore;
                }
            };
            
            gameContainer.appendChild(target);
            
            // Remover target después de 3 segundos
            setTimeout(() => {
                if (target.parentNode) {
                    target.remove();
                }
            }, 3000);
        }

        function endTargetGame() {
            clearInterval(targetGameInterval);
            document.querySelectorAll('.target').forEach(target => target.remove());
            
            const resultElement = document.getElementById('targetResult');
            resultElement.textContent = `🎯 Juego terminado! Puntuación final: ${targetScore}`;
            resultElement.style.color = '#4CAF50';
        }

        // ========== FUNCIONES AUXILIARES ==========

        function searchSchedule(query) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';
            
            if (!query.trim()) return;
            
            const results = [];
            scheduleData.forEach((row, rowIndex) => {
                row.forEach((cell, cellIndex) => {
                    if (cellIndex > 0 && cell !== 'DESCANSO' && 
                        cell.toLowerCase().includes(query.toLowerCase())) {
                        results.push({
                            subject: cell,
                            time: scheduleData[rowIndex][0],
                            day: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes'][cellIndex - 1]
                        });
                    }
                });
            });
            
            results.forEach(result => {
                const div = document.createElement('div');
                div.className = 'search-result';
                div.innerHTML = `
                    <strong>${result.subject}</strong><br>
                    <small>${result.day} - ${result.time}</small>
                `;
                div.onclick = () => highlightSearchResult(result);
                resultsContainer.appendChild(div);
            });
        }

        function highlightSearchResult(result) {
            showNotification(`🔍 Encontrado: ${result.subject} - ${result.day} ${result.time}`);
        }

        function updateWeekendCountdown() {
            const now = new Date();
            const currentDay = now.getDay();
            let daysUntilWeekend = 5 - currentDay;
            
            if (currentDay === 0 || currentDay === 6) {
                daysUntilWeekend = 0;
            } else if (daysUntilWeekend < 0) {
                daysUntilWeekend = 0;
            }
            
            const countdownElement = document.getElementById('weekendCountdown');
            const messageElement = document.getElementById('weekendMessage');
            
            if (daysUntilWeekend === 0) {
                countdownElement.textContent = '¡Es fin de semana! 🎉';
                messageElement.textContent = '¡Disfruta tu descanso!';
            } else {
                countdownElement.textContent = `${daysUntilWeekend} día${daysUntilWeekend > 1 ? 's' : ''}`;
                messageElement.textContent = daysUntilWeekend === 1 ? '¡Mañana es viernes! 💪' : '¡Tú puedes! 💪';
            }
        }

        function calculateStats() {
            const subjects = new Set();
            let totalClasses = 0;
            
            scheduleData.forEach(row => {
                row.slice(1).forEach(cell => {
                    if (cell && cell !== 'DESCANSO') {
                        subjects.add(cell);
                        totalClasses++;
                    }
                });
            });
            
            document.getElementById('totalHours').textContent = Math.round(totalClasses * 0.9);
            document.getElementById('totalSubjects').textContent = subjects.size;
        }

        function renderSchedule() {
            const table = document.getElementById('scheduleTable');
            table.innerHTML = '';

            const headerRow = table.insertRow();
            const days = ['⏰ Horario', '📅 Lunes', '📅 Martes', '📅 Miércoles', '📅 Jueves', '📅 Viernes'];
            
            days.forEach(day => {
                const th = document.createElement('th');
                th.textContent = day;
                headerRow.appendChild(th);
            });

            scheduleData.forEach((rowData, index) => {
                const row = table.insertRow();
                if (index === 3) row.classList.add('break-row');

                rowData.forEach((cellData, cellIndex) => {
                    const cell = row.insertCell();
                    
                    if (cellIndex === 0) {
                        cell.classList.add('time-cell');
                        cell.textContent = cellData;
                    } else {
                        let displayText = cellData;
                        
                        if (state.showAbbreviations && subjectAbbreviations[cellData]) {
                            displayText = subjectAbbreviations[cellData];
                        }
                        
                        if (cellData !== 'DESCANSO' && subjectIcons[cellData]) {
                            displayText = subjectIcons[cellData] + ' ' + displayText;
                        }
                        
                        cell.innerHTML = displayText;
                        
                        if (state.showColors && subjectColors[cellData]) {
                            cell.classList.add(subjectColors[cellData]);
                        }
                    }
                });
            });
        }

        function setupEventListeners() {
            document.getElementById('themeSelector').addEventListener('change', function(e) {
                changeTheme(e.target.value);
            });
        }

        function changeTheme(theme) {
            document.body.className = '';
            if (theme) {
                document.body.classList.add(`theme-${theme}`);
            }
            state.currentTheme = theme;
            
            const themesTried = new Set(JSON.parse(localStorage.getItem('themesTried') || '[]'));
            themesTried.add(theme);
            localStorage.setItem('themesTried', JSON.stringify([...themesTried]));
            
            if (themesTried.size >= 4) {
                unlockAchievement('theme_master');
            }

            showNotification(`🎨 Tema cambiado a: ${getThemeName(theme)}`);
        }

        function getThemeName(theme) {
            const names = {
                '': 'Futurista',
                'university': 'Universidad',
                'cyberpunk': 'Cyberpunk',
                'retro': 'Retro 8-bit',
                'neon-glitch': 'Neón Glitch',
                'galaxy': 'Galaxia',
                'synthwave': 'Synthwave',
                'rainbow': 'Arcoíris'
            };
            return names[theme] || 'Desconocido';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.background = type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ========== SISTEMA DE LOGROS ==========

        function loadAchievements() {
            const saved = localStorage.getItem('eduScheduleAchievements');
            if (saved) {
                state.unlockedAchievements = new Set(JSON.parse(saved));
            }
        }

        function saveAchievements() {
            localStorage.setItem('eduScheduleAchievements', 
                JSON.stringify([...state.unlockedAchievements]));
        }

        function unlockAchievement(achievementId) {
            if (!state.unlockedAchievements.has(achievementId)) {
                state.unlockedAchievements.add(achievementId);
                saveAchievements();
                
                const achievement = achievements.find(a => a.id === achievementId);
                if (achievement) {
                    showNotification(`🏆 Logro desbloqueado: ${achievement.name}`, 'success');
                }
            }
        }

        function checkTimeBasedAchievements(now) {
            const hour = now.getHours();
            
            if (hour < 7) {
                unlockAchievement('early_bird');
            }
            
            if (hour >= 22) {
                unlockAchievement('night_owl');
            }
        }

        function showAchievements() {
            const modal = document.getElementById('achievementsModal');
            const list = document.getElementById('achievementsList');
            
            list.innerHTML = achievements.map(achievement => `
                <div class="achievement-badge ${state.unlockedAchievements.has(achievement.id) ? '' : 'badge-locked'}">
                    <span>${achievement.icon}</span>
                    <div>
                        <strong>${achievement.name}</strong><br>
                        <small>${achievement.description}</small>
                    </div>
                </div>
            `).join('');
            
            modal.style.display = 'flex';
        }

        // ========== CALCULADORA ==========

        function showGradeCalculator() {
            document.getElementById('calculatorModal').style.display = 'flex';
        }

        function calculateRequiredGrade() {
            const current = parseFloat(document.getElementById('currentGrade').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const desired = parseFloat(document.getElementById('desiredGrade').value);
            
            if (isNaN(current) || isNaN(weight) || isNaN(desired)) {
                document.getElementById('calculationResult').textContent = 'Por favor, completa todos los campos';
                return;
            }
            
            const required = (desired - (current * (weight / 100))) / ((100 - weight) / 100);
            document.getElementById('calculationResult').innerHTML = `
                <strong>Necesitas: ${required.toFixed(2)}</strong><br>
                <small>en el resto de la ponderación (${100 - weight}%)</small>
            `;
        }
    </script>
</body>
</html>
